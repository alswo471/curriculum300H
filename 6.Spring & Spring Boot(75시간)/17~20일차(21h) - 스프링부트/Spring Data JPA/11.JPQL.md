# JPQL(Java Persistence Query Language)

- JPA가 공식 지원하는 기능
	- JPQL(Java Persistence Query Language)
	- Criteria 쿼리(Criteria Query) : JPQL을 편하게 작성하도록 도와주는 API 빌더 클래스 모음 
	- 네이티브 SQL(Native SQL) : JPA에서 JPQL 대신 SQL 직접 사용

- 그 외
	- QueryDSL
		- JPQL을 편하게 작성하도록 도와주는 빌더 클래스 모음
		- 비표준 오픈소스 프레임워크 
	- 필요하다면 JDBC 직접 사용가능
		- JDBC 직접 사용 
		- SQL 매퍼 프레임워크 사용 예) MyBatis
		
## JPQL 소개

### JPQL(Java Persistence Query Language)

- 엔티티 객체를 조회하는 객체 지향 쿼리

### 등장 배경

- 기존의 검색 방법 
	- 식별자로 엔티티 조회 <code>EntityManager.find()</code>
	- 조회한 엔티티에 객체 그래프 탐색 사용 예) <code>a.getB().getC()</code>
	- 위의 기능만으로 애플리케이션을 개발하기는 어려움
	
- JPQL 등장 배경
	- 검색하고 싶은 모든 엔티티를 메모리에 올려두고 애플리케이션에서 조건에 맞는 객체를 검색하는 것은 현실성이 부족함.
	- 데이터는 DB에 있으므로 SQL로 필요한 내용을 최대한 걸러서 조회해야 함.
	- ORM을 사용하면 엔티티 객체를 대상으로 개발하므로, 검색도 테이블이 아닌 <b>엔티티 객체</b>를 대상으로 하는 방법 필요.
	
### 특징

- 문법이 SQL과 비슷함
- ANSI 표준 SQL이 제공하는 기능을 유사하게 지원
- 엔티티 객체를 대상으로 쿼리
- <b>SQL 추상화 -> 특정 테이터베이스에 의존하지 않는다.</b>
	- 데이터베이스 방언(Dialect)만 변경하면 JPQL을 수정하지 않아도 데이터베이스 변경 가능
- SQL보다 간결
	- 엔티티 직접 조회
	- 묵시적 조인 
	- 다형성 지원
- 결국에는 SQL로 변환 됨

## 기본 문법과 쿼리 API
- SELECT, UPDATE, DELETE 문 사용 가능 
- INSERT 문은 사용 불가 -> <code>EntityManager.persist()</code> 사용하여 엔티티 저장 

#### JPQL 문법 

- select 문 

```
select_절 
from_절
[where_절]
[[groupby_절]
[having_절]
[orderby_절]
```

- update 문

```
update_절 [where_절]
```

- delete 문 

```
delete_절 [where_절]
```


### SELECT 문

```sql
SELECT m FROM Member AS m WHERE m.username = "Hello"

```

- 대소문자 구분
	- 엔티티와 속성은 대소문자를 구분한다.
		- 예) Member ≠ member   /    username ≠ Username
	- JPQL 키워드는 대소문자를 구분하지 않는다. 
		- 예) SELECT = select  /   FROM = from    /    AS  =  as
		
- 엔티티 이름
	- <code>Member</code>는 클래스이름이 아니라 <b>엔티티이름</b>이다.
	- 엔티티 이름 지정 : <code>@Entity(name="XXX")</code>
	- 기본값 : 클래스 이름(권장사항)

- JPQL은 별칭 사용 필수

```
SELECT username From Member m  -> 잘못된 문법
-> SELECT m.usename FROM member m
```

- <code>AS</code>는 생략 가능 : Member AS m = Member m

> <b>HQL(Hibernate Query Language)</b><br>- 하이버네이트는 HQL을 제공<br>- JPA 구현체로 하이버네이트 사용 시 HQL 사용 가능<br>별칭 없이 사용 가능

> JPA 표준 명세는 별칭을 <b>식별 변수(Identification variable)</b> 정의


## TypeQuery, Query

- 작성한 JPQL을 실행하기 위한 쿼리 객체
- 차이점
	- <code>TypeQuery</code> : 변환 타입 명확하게 지정 가능
	- <code>Query</code> : 변환 타입 명확하게 지정 불가능 