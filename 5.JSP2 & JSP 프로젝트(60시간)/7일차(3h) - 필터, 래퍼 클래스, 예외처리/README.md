# 필터와 래퍼
- 웹 사이트를 개발하다보면 여러 웹 컴포넌트(JSP 페이지와 서블릿 클래스의 통칭)에 똑같은 사전작업이나 사후 작업을 해야 하는 경우가 종종 있습니다. 예를 들어 어떤 웹 컴포넌트는 로그인한 다음에만 사용할 수 있어야 하기 때문에 먼저 로그인 여부를 체크해야 합니다. 그리고 어떤 웹 컴포넌트는 유료 서비스를 제공하기 때문에 실행 후에 요금을 부과하는 처리를 해야 합니다.

- 각각의 웹 컴포넌트 마다 이런 코드를 따로 작성해 둔다면, 프로그래밍 분량이 굉장히 많아질 것이고, 코드 간의 일관성을 유지하기도 힘들어질 것입니다. 그러므로 이런 코드는 한 곳에 작성해 놓고 공통적으로 사용할 수 있으면 편리할 것입니다. 필터와 래퍼는 그러한 방법을 제공하는 기술입니다.

- 필터(fiilter)란 글자 그대로 여과기 역할을 하는 프로그램입니다. 이프로그램은 자바 클래스 형태로 구현해야 하는데, 이 클래스를 필터 클래스(filter class)라고 합니다. 하지만 이 클래스가 클래스 형태 그대로 바로 실행되는 것은 아닙니다. 

- 웹 컨터이너는 이 클래스를 가지고 필터 객체를 만들고, 그 다음에 그 필터 객체를 초기화합니다. 그리고 나서야 비로소 그 객체가 필터로서 실행될 수 있습니다. 이것은 서블릿 클래스가 서블릿 객체로 만들어지고, 초기화되고 난 다음에 실행되는 것과 마찬가지 입니다.

#### 필터 클래스, 필터 객체, 필터 

![filter1](https://raw.githubusercontent.com/yonggyo1125/curriculum300H/main/5.JSP2%20%26%20JSP%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8(60%EC%8B%9C%EA%B0%84)/7%EC%9D%BC%EC%B0%A8(3h)%20-%20%ED%95%84%ED%84%B0%2C%20%EB%9E%98%ED%8D%BC%20%ED%81%B4%EB%9E%98%EC%8A%A4%2C%20%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC/images/filter1.png)

- 초기화된 필터는 웹 브라우저와 웹 컴포넌트 사이에 위치하게 됩니다.
- 웹 브라우저가 웹 컴포넌트를 호출했을 때 그 대신 필터가 호출되며, 필터는 사전작업을 수행한 다음에 웹 컴포넌트를 호출할 것입니다.
- 그때부터 웹 컴포넌트가 시작되어서 실행되고, 실행이 끝나고 나면 제어 흐름은 다시 필터로 되돌가갈 것입니다.  그러면 필터는 필요한 사후작업을 수행한 다음에 웹브라우저로 응답을 보낼 것입니다.

#### 필터가 위치하는 곳 

![filter2](https://raw.githubusercontent.com/yonggyo1125/curriculum300H/main/5.JSP2%20%26%20JSP%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8(60%EC%8B%9C%EA%B0%84)/7%EC%9D%BC%EC%B0%A8(3h)%20-%20%ED%95%84%ED%84%B0%2C%20%EB%9E%98%ED%8D%BC%20%ED%81%B4%EB%9E%98%EC%8A%A4%2C%20%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC/images/filter2.png)

- 로그인 여부의 확인이나 요금 부과 처리와 같은 일은 필터 클래스 안에 구현해 놓으면 됩니다.
- 하지만 필터 클래스만 가지고는 할 수 없는 일도 있습니다. 웹 브라우저와 웹 컴포넌트 사이를 오가는 데이터를 변경하는 일은 할 수 없습니다.
- 예를 들어 웹 브라우저와 웹 컴포넌트 사이를 오가는 메시지를 암호화하거나, 메시지에 포함된 데이터의 일부를 걸러서 전달되지 못하도록 막는 일은 할 수 없습니다.
- 그런 일을 하기 위해서는 필터뿐만 아니라 래퍼도 필요합니다.

- 래퍼(wrapper)란 글자 그대로 무언가를 포장하는 프로그램입니다.  즉, 웹브라우저와 웹 컴포넌트 사이를 오가는 요청 메시지와 응답 메시지를 포장합니다.
- 래퍼는 래퍼 클래스(wrapper class) 형태로 구현되고, 포장되는 객체의 종류에 따라 요청 래퍼 클래스와 응답 래퍼 클래스로 나뉘어 집니다.
- 웹 컨테이너는 웹 브라우저로부터 요청을 받으면 요청 객체와 응답 객체를 만들어서 웹 컴포넌트로 전달합니다. 그것이 바로 doGet, doPost 메서드의 파라미터 변수나 request, response 내장 객체를 통해 서블릿과  JSP 페이지로 전달되는 값입니다. 하지만 웹 브라우저와 웹 컴포넌트 사이에 필터가 있으면 이 두 객체는 필터로 넘겨집니다.
- 이때 필터가 요청 래퍼 클래스와 응답 래퍼 클래스를 가지고 이 두 객체를 포장한 다음에 웹 컴포넌트로 전달하면 웹 컴포넌트는 새로운 두 객체를 기존의 요청 객체와 응답 객체인 줄 알고 사용할 것입니다.

#### 요청 래퍼 객체와 응답 래퍼 객체 

![filter3](https://raw.githubusercontent.com/yonggyo1125/curriculum300H/main/5.JSP2%20%26%20JSP%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8(60%EC%8B%9C%EA%B0%84)/7%EC%9D%BC%EC%B0%A8(3h)%20-%20%ED%95%84%ED%84%B0%2C%20%EB%9E%98%ED%8D%BC%20%ED%81%B4%EB%9E%98%EC%8A%A4%2C%20%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC/images/filter3.png)

- 래퍼 클래스 안에 입력 데이터와 출력 데이터를 변형하는 로직을 구사해 놓으면 웹 컴포넌트가 요청 래퍼 객체와 응답 래퍼 객체를 사용할 때 그 로직이 실행될 것이고 그 결과 변형된 데이터가 웹 브라우저 또는 웹 컴포넌트로 전송될 것입니다.

## 필터 클래스의 작성, 설치, 등록 

- 필터 클래스를 작성할 때는 서블릿 규격서에 정해져 있는 규칙을 지켜야 합니다.
- 그중 가장 중요한 규칙은 **javax.servlet.Filter 인터페이스**를 구현해야 한다는 것입니다.
- [Filter 인터페이스](https://javaee.github.io/javaee-spec/javadocs/javax/servlet/Filter.html)




* * * 
# 래퍼 클래스 작성 및 적용하기

* * * 
# 예외처리

##page 디렉티브 태그를 이용한 예외처리

## web.xml 파일을 이용한 예외처리

## try/catch/finally를 이용한 예외처리